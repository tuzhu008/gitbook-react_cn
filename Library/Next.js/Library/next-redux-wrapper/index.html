
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>next-redux-wrapper · React.js 及周边</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="tuzhu008">
        
        
    
    <link rel="stylesheet" href="../../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-prism/prism-atom-dark.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../../../styles/website.css">
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../../dva/README_zh-CN.html" />
    
    
    <link rel="prev" href="../../" />
    

    
        <link rel="shortcut icon" href='../../../../assets/images/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../../../../assets/images/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../../../../assets/images/apple-touch-icon.png'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../../../../assets/images/apple-touch-icon-120x120.png">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../../../../assets/images/apple-touch-icon-180x180.png">
        
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../../">
            
                <a href="../../../../">
            
                    
                    关于本书
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../../../GLOSSARY.html">
            
                <a href="../../../../GLOSSARY.html">
            
                    
                    术语
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../../../_Questions/faq.html">
            
                <a href="../../../../_Questions/faq.html">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">参考文档</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../../../Create-React-App/">
            
                <a href="../../../../Create-React-App/">
            
                    
                    Create React App
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../../../Create-React-App/guide.html">
            
                <a href="../../../../Create-React-App/guide.html">
            
                    
                    指南
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">核心库</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    redux
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../../react-redux/">
            
                <a href="../../../react-redux/">
            
                    
                    react-redux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../../../react-redux/docs/">
            
                <a href="../../../react-redux/docs/">
            
                    
                    文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1.1" data-path="../../../react-redux/docs/api.html">
            
                <a href="../../../react-redux/docs/api.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.1.2" data-path="../../../react-redux/docs/troubleshooting.html">
            
                <a href="../../../react-redux/docs/troubleshooting.html">
            
                    
                    解决问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" >
            
                <a target="_blank" href="https://tuzhu008.github.io/gitbook-react-router_cn/">
            
                    
                    react-router
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <span>
            
                    
                    react-router-redux
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../../prop-types/">
            
                <a href="../../../prop-types/">
            
                    
                    prop-types
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    

    
        
        <li class="header">常用库</li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <span>
            
                    
                    react-autosuggest
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">组件库</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../../components/react-helmet/">
            
                <a href="../../../components/react-helmet/">
            
                    
                    react-helmet
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">CSS In JS</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../../styled-jsx/">
            
                <a href="../../../styled-jsx/">
            
                    
                    styled-jsx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../../../radium/">
            
                <a href="../../../radium/">
            
                    
                    radium
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.2.1" data-path="../../../radium/docs/">
            
                <a href="../../../radium/docs/">
            
                    
                    文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.2.1.1" data-path="../../../radium/docs/guides/">
            
                <a href="../../../radium/docs/guides/">
            
                    
                    指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2.1.2" data-path="../../../radium/docs/api/">
            
                <a href="../../../radium/docs/api/">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2.1.3" data-path="../../../radium/docs/faq/">
            
                <a href="../../../radium/docs/faq/">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../../../react-css-modules/">
            
                <a href="../../../react-css-modules/">
            
                    
                    react-css-modules
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">其他库</li>
        
        
    
        <li class="chapter " data-level="8.1" >
            
                <span>
            
                    
                    recharts
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" >
            
                <a target="_blank" href="https://tuzhu008.github.io/gitbook-awesome_libraries_cn/Library/text-mask/">
            
                    
                    text-mark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../../">
            
                <a href="../../">
            
                    
                    Next.js
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="8.3.1" data-path="./">
            
                <a href="./">
            
                    
                    next-redux-wrapper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="../../../dva/README_zh-CN.html">
            
                <a href="../../../dva/README_zh-CN.html">
            
                    
                    dva
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.4.1" data-path="../../../dva/docs/GettingStarted.html">
            
                <a href="../../../dva/docs/GettingStarted.html">
            
                    
                    入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4.2" data-path="../../../dva/docs/API_zh-CN.html">
            
                <a href="../../../dva/docs/API_zh-CN.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4.3" data-path="../../../dva/docs/Concepts_zh-CN.html">
            
                <a href="../../../dva/docs/Concepts_zh-CN.html">
            
                    
                    Concepts
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../../.." >next-redux-wrapper</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><span class="title-icon "></span><a href="#redux-wrapper-for-nextjs"><b>1. </b>Redux wrapper for Next.js</a></li><ul><li><span class="title-icon "></span><a href="#usage"><b>1.1. </b>Usage</a></li><li><span class="title-icon "></span><a href="#how-it-works"><b>1.2. </b>How it works</a></li><li><span class="title-icon "></span><a href="#async-actions-in-getinitialprops"><b>1.3. </b>Async actions in getInitialProps</a></li><li><span class="title-icon "></span><a href="#usage-with-immutablejs"><b>1.4. </b>Usage with Immutable.JS</a></li><li><span class="title-icon "></span><a href="#resources"><b>1.5. </b>Resources</a></li></ul></ul></div><a href="#redux-wrapper-for-nextjs" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="redux-wrapper-for-nextjs"><a name="redux-wrapper-for-nextjs" class="anchor-navigation-ex-anchor" href="#redux-wrapper-for-nextjs"><i class="fa fa-link" aria-hidden="true"></i></a>1. Redux wrapper for Next.js</h1>
<p><img src="https://travis-ci.org/kirill-konshin/next-redux-wrapper.svg?branch=master" alt="Build status"></p>
<h2 id="usage"><a name="usage" class="anchor-navigation-ex-anchor" href="#usage"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. Usage</h2>
<pre class="language-"><code class="lang-bash"><span class="token function">npm</span> <span class="token function">install</span> next-redux-wrapper --save
</code></pre>
<p>Wrapper has to be attached your page components (located in <code>/pages</code>). For safety it is recommended
to wrap all pages, no matter if they use Redux or not, so that you should not care about it anymore in
all child components.</p>
<p>Here is the minimal setup (<code>makeStore</code> and <code>reducer</code> usually are located in other files):</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> withRedux <span class="token keyword">from</span> <span class="token string">&quot;next-redux-wrapper&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token punctuation">:</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&apos;FOO&apos;</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> foo<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
* @param {object} initialState
* @param {boolean} options.isServer indicates whether it is a server side or client side
* @param {Request} options.req NodeJS Request object (if any)
* @param {boolean} options.debug User-defined debug mode param
* @param {string} options.storeKey This key will be used to preserve store in global namespace for safe HMR 
*/</span>
<span class="token keyword">const</span> makeStore <span class="token operator">=</span> <span class="token punctuation">(</span>initialState<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Page</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>store<span class="token punctuation">,</span> isServer<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> query<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token string">&apos;FOO&apos;</span><span class="token punctuation">,</span> payload<span class="token punctuation">:</span> <span class="token string">&apos;foo&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// component will be able to read from store&apos;s state when rendered</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>custom<span class="token punctuation">:</span> <span class="token string">&apos;custom&apos;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// you can pass some custom props to component from here</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Prop <span class="token keyword">from</span> Redux <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>foo<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Prop <span class="token keyword">from</span> getInitialProps <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>custom<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Page <span class="token operator">=</span> <span class="token function">withRedux</span><span class="token punctuation">(</span>makeStore<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token punctuation">:</span> state<span class="token punctuation">.</span>foo<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Page<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Page<span class="token punctuation">;</span>
</code></pre>
<h2 id="how-it-works"><a name="how-it-works" class="anchor-navigation-ex-anchor" href="#how-it-works"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. How it works</h2>
<p>No magic is involved, it auto-creates Redux store when <code>getInitialProps</code> is called by Next.js and then passes this store
down to React Redux&apos;s <code>Provider</code>, which is used to wrap the original component, also automatically. On the client side
it also takes care of using same store every time, whereas on server new store is created for each request.</p>
<p>The <code>withRedux</code> function accepts <code>makeStore</code> as first argument, all other arguments are internally passed to React
Redux&apos;s <code>connect()</code> function for simplicity. The <code>makeStore</code> function will receive initial state as one argument and
should return a new instance of redux store each time when called, no memoization needed here, it is automatically done
inside the wrapper.</p>
<p><code>withRedux</code> also optionally accepts an object. In this case only 1 parameter is passed which can contain the following
configuration properties:</p>
<ul>
<li><code>createStore</code> (required, function) : the <code>makeStore</code> function as described above</li>
<li><code>storeKey</code> (optional, string) : the key used on <code>window</code> to persist the store on the client</li>
<li><code>debug</code> (optional, boolean) : enable debug logging</li>
<li><code>mapStateToProps</code>, <code>mapDispatchToProps</code>, <code>mergeProps</code> (optional, functions) : functions to pass to <code>react-redux</code> <code>connect</code> method</li>
<li><code>connectOptions</code> (optional, object) : configuration to pass to <code>react-redux</code> <code>connect</code> method</li>
</ul>
<p>When <code>makeStore</code> is invoked it is also provided a configuration object as the second parameter, which includes:</p>
<ul>
<li><code>isServer</code> (boolean): <code>true</code> if called while on the server rather than the client</li>
<li><code>req</code> (Request): The <code>next.js</code> <code>getInitialProps</code> context <code>req</code> parameter</li>
<li><code>query</code> (object): The <code>next.js</code> <code>getInitialProps</code> context <code>query</code> parameter</li>
</ul>
<p>The object also includes all configuration as passed to <code>withRedux</code> if called with an object of configuration properties.</p>
<p><strong>Use <code>withRedux</code> to wrap only top level pages! All other components should keep using regular <code>connect</code> function of
React Redux.</strong></p>
<p>Although it is possible to create server or client specific logic in both <code>createStore</code> function and <code>getInitialProps</code>
method I highly don&apos;t recommend to have different behavior. This may cause errors and checksum mismatches which in turn
will ruin the whole purpose of server rendering.</p>
<p>I don&apos;t recommend to use <code>withRedux</code> in both top level pages and <code>_document.js</code> files, Next.JS
<a href="https://github.com/zeit/next.js/issues/1267" target="_blank">does not have provide</a> a reliable way to determine the sequence when
components will be rendered. So per Next.JS recommendation it is better to have just data-agnostic things in <code>_document</code>
and wrap top level pages with another HOC that will use <code>withRedux</code>. </p>
<h2 id="async-actions-in-getinitialprops"><a name="async-actions-in-getinitialprops" class="anchor-navigation-ex-anchor" href="#async-actions-in-getinitialprops"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. Async actions in getInitialProps</h2>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">someAsyncAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">&apos;FOO&apos;</span><span class="token punctuation">,</span>
        payload<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token string">&apos;foo&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>store<span class="token punctuation">,</span> isServer<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> query<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// lets create an action using creator</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">someAsyncAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// now the action has to be dispatched</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// once the payload is available we can resume and render the app</span>
    <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// you can do something with payload now</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>custom<span class="token punctuation">:</span> <span class="token string">&apos;custom&apos;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
<h2 id="usage-with-immutablejs"><a name="usage-with-immutablejs" class="anchor-navigation-ex-anchor" href="#usage-with-immutablejs"><i class="fa fa-link" aria-hidden="true"></i></a>1.4. Usage with Immutable.JS</h2>
<p>If you want to use Immutable.JS then you have to modify your <code>makeStore</code> function, it should detect if object is an instance of Immutable.JS, and if not - convert it using <code>Immutable.fromJS</code>:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">makeStore</span><span class="token punctuation">(</span>initialState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Nasty duck typing, you should find a better way to detect</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>initialState<span class="token punctuation">.</span>toJS<span class="token punctuation">)</span> initialState <span class="token operator">=</span> Immutable<span class="token punctuation">.</span><span class="token function">fromJS</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The reason is that <code>initialState</code> is transferred over the network from server to client as a plain object (it is automatically serialized on server) so it should be converted back to Immutable.JS on client side.</p>
<p>Here you can find better ways to detect if an object is Immutable.JS: <a href="https://stackoverflow.com/a/31919454/5125659" target="_blank">https://stackoverflow.com/a/31919454/5125659</a>.</p>
<h2 id="resources"><a name="resources" class="anchor-navigation-ex-anchor" href="#resources"><i class="fa fa-link" aria-hidden="true"></i></a>1.5. Resources</h2>
<ul>
<li><a href="https://github.com/bmealhouse/next-redux-saga" target="_blank">next-redux-saga</a></li>
<li><a href="https://www.robinwieruch.de/nextjs-redux-saga/" target="_blank">How to use with Redux and Redux Saga</a></li>
<li>Redux Saga Example: <a href="https://gist.github.com/pesakitan22/94b4984140ba0f2c9e52c5289a7d833e" target="_blank">https://gist.github.com/pesakitan22/94b4984140ba0f2c9e52c5289a7d833e</a>.</li>
<li><a href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/next-redux-wrapper" target="_blank">Typescript type definitions</a> &gt; <code>npm install @types/next-redux-wrapper</code></li>
</ul>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; tuzhu008 2017 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2018-01-20 11:48:21
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../../" class="navigation navigation-prev " aria-label="Previous page: Next.js">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../../dva/README_zh-CN.html" class="navigation navigation-next " aria-label="Next page: dva">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"next-redux-wrapper","level":"8.3.1","depth":2,"next":{"title":"dva","level":"8.4","depth":1,"path":"Library/dva/README_zh-CN.md","ref":"Library/dva/README_zh-CN.md","articles":[{"title":"入门","level":"8.4.1","depth":2,"path":"Library/dva/docs/GettingStarted.md","ref":"Library/dva/docs/GettingStarted.md","articles":[]},{"title":"API","level":"8.4.2","depth":2,"path":"Library/dva/docs/API_zh-CN.md","ref":"Library/dva/docs/API_zh-CN.md","articles":[]},{"title":"Concepts","level":"8.4.3","depth":2,"path":"Library/dva/docs/Concepts_zh-CN.md","ref":"Library/dva/docs/Concepts_zh-CN.md","articles":[]}]},"previous":{"title":"Next.js","level":"8.3","depth":1,"path":"Library/Next.js/README.md","ref":"Library/Next.js/README.md","articles":[{"title":"next-redux-wrapper","level":"8.3.1","depth":2,"path":"Library/Next.js/Library/next-redux-wrapper/README.md","ref":"Library/Next.js/Library/next-redux-wrapper/README.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["expandable-chapters-small","anchors","anchor-navigation-ex","favicon","copy-code-button","alerts","splitter","book-summary-scroll-position-saver","include-codeblock","ace","prism","prism-themes","-highlight","tbfed-pagefooter","github","sectionx","livereload"],"root":".","styles":{"website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy tuzhu008 2017","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-atom-dark.css"]},"ace":{},"github":{"url":"https://github.com/tuzhu008"},"livereload":{},"book-summary-scroll-position-saver":{},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"night","family":"serif","size":2},"sectionx":{"tag":"b"},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showLevel":true},"favicon":{"shortcut":"assets/images/favicon.ico","bookmark":"assets/images/favicon.ico","appleTouch":"assets/images/apple-touch-icon.png","appleTouchMore":{"120x120":"assets/images/apple-touch-icon-120x120.png","180x180":"assets/images/apple-touch-icon-180x180.png"}},"prism-themes":{},"alerts":{},"expandable-chapters-small":{},"copy-code-button":{},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"acefull","theme":"tomorrow","unindent":true},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"tuzhu008","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"React.js 及周边","language":"zh-hans","gitbook":"*","description":"React.js 自我学习"},"file":{"path":"Library/Next.js/Library/next-redux-wrapper/README.md","mtime":"2018-01-20T03:48:21.465Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-01-29T06:10:17.822Z"},"basePath":"../../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../../gitbook/gitbook.js"></script>
    <script src="../../../../gitbook/theme.js"></script>
    
        
        <script src="../../../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-alerts/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-book-summary-scroll-position-saver/book-summary-scroll-position-saver.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

